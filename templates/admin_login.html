<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login - The Social Sort</title>
    <!-- Google Fonts Import -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Ubuntu+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #F5F1EB;
            --text-color: #333333;
            --primary-font: 'Ubuntu Sans', sans-serif;
            --secondary-font: 'Playfair Display', serif;
            --button-bg-color: #373737;
            --button-text-color: #ffffff;
            --border-color: #E0D9D1;
            --danger-color: #d9534f;
        }
        body {
            font-family: var(--primary-font);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            box-sizing: border-box;
        }
        pre#ascii-art {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre;
            color: #ccc; /* Darker ASCII art color */
            overflow: hidden;
            user-select: none;
            z-index: 1;
        }
        .login-container {
            width: 100%;
            max-width: 400px;
            padding: 3rem;
            background-color: #fff;
            box-shadow: 0 4px 25px rgba(0,0,0,0.1);
            text-align: center;
            z-index: 2; /* Ensure it's on top of the ASCII art */
            position: relative;
        }
        h2 {
            font-family: var(--secondary-font);
            font-size: 2.5rem;
            font-weight: 400;
            margin-bottom: 2rem;
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 50px;
            font-family: var(--primary-font);
            font-size: 1rem;
            box-sizing: border-box;
        }
        .btn-submit {
            width: 100%;
            padding: 1rem;
            background-color: var(--button-bg-color);
            color: var(--button-text-color);
            border: none;
            border-radius: 50px;
            font-family: var(--primary-font);
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-top: 1rem;
        }
        .btn-submit:hover {
            background-color: #2a2a2a;
        }
        .error-message {
            color: var(--danger-color);
            background-color: rgba(217, 83, 79, 0.1);
            border: 1px solid var(--danger-color);
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1.5rem;
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>
    <pre id="ascii-art"></pre>
    <div class="login-container">
        <h2>Admin Login</h2>
        <form id="adminForm">
            <div class="input-group">
                <input type="text" name="username" placeholder="Username" required>
            </div>
            <div class="input-group">
                <input type="password" name="password" placeholder="Password" required>
            </div>
            <button type="submit" class="btn-submit">Login</button>
        </form>
        <div id="errorMessage" class="error-message"></div>
    </div>

    <script>
        // --- Login Form Logic ---
        document.getElementById('adminForm').onsubmit = async e => {
            e.preventDefault();
            const username = e.target.username.value;
            const password = e.target.password.value;
            const errorMessageDiv = document.getElementById('errorMessage');

            errorMessageDiv.style.display = 'none'; // Hide previous errors

            const res = await fetch('/admin_login', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({username, password})
            });
            const data = await res.json();
            if (data.status === 'success') {
                window.location.href = data.redirect;
            } else {
                errorMessageDiv.textContent = data.message;
                errorMessageDiv.style.display = 'block';
            }
        };

        // --- ASCII Art Logic ---
        const pre = document.getElementById('ascii-art');
        let widthChars, heightChars;
        let lastFrameTime = performance.now();
        let t = 0;

        const SCALE = 10;
        const SPEED = 0.3;
        const CHARSET = '.:-=+*#%@';

        function computeDimensions() {
            pre.style.fontSize = `${SCALE}px`;
            pre.style.lineHeight = `${SCALE}px`;
            
            const charWidth = SCALE * 0.6;
            const charHeight = SCALE;

            widthChars = Math.floor(window.innerWidth / charWidth);
            heightChars = Math.floor(window.innerHeight / charHeight);
        }

        function valueNoise2D(x, y){
            const x0 = Math.floor(x), y0 = Math.floor(y);
            function rand(i, j){
                const s = Math.sin(i*127.1 + j*311.7) * 43758.5453;
                return s - Math.floor(s);
            }
            const v00 = rand(x0, y0), v10 = rand(x0+1, y0), v01 = rand(x0, y0+1), v11 = rand(x0+1, y0+1);
            const u = (x - x0)**2 * (3 - 2*(x-x0)), v = (y - y0)**2 * (3 - 2*(y-y0));
            return v00*(1-u)*(1-v) + v10*u*(1-v) + v01*(1-u)*v + v11*u*v;
        }

        function mapToChar(v) {
            const i = Math.max(0, Math.min(CHARSET.length - 1, Math.floor(v * CHARSET.length)));
            return CHARSET[i];
        }

        function renderFrame(dt) {
            t += dt * SPEED;
            let output = '';

            for (let y = 0; y < heightChars; y++) {
                for (let x = 0; x < widthChars; x++) {
                    const u = x / widthChars, v = y / heightChars;
                    const val = (valueNoise2D(u*8 + t*0.2, v*8 - t*0.2) + 
                                 valueNoise2D(u*16 - t*0.1, v*16 + t*0.1) * 0.5) / 1.5;
                    output += mapToChar(val);
                }
                output += '\n';
            }
            pre.textContent = output;
        }

        function animate(now) {
            const dt = Math.min(0.06, (now - lastFrameTime) / 1000);
            lastFrameTime = now;
            renderFrame(dt);
            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', computeDimensions);

        // Initial setup
        computeDimensions();
        requestAnimationFrame(animate);
    </script>
</body>
</html>
