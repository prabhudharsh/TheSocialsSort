<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Animated ASCII Art</title>
  <style>
    :root{
      --bg: #0b0f14;
      --fg: #d9e7ff;
      --muted: #7a8aa1;
      --accent: #61dafb;
    }
    html,body{
      height:100%;
      width:100%;
      margin:0;
      background: radial-gradient(1200px 800px at 20% 10%, #111827, var(--bg));
      color: var(--fg);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      overflow:hidden;
    }
    .panel{
      position:fixed;
      top:0;
      left:0;
      right:0;
      bottom:0;
      display:flex;
      flex-direction:column;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
      border:none;
    }
    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:12px 16px;
      align-items:center;
      padding:10px 16px;
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0));
      border-bottom: 1px solid rgba(255,255,255,0.06);
      z-index:10;
    }
    .toolbar label{ font-size:12px; color:var(--muted); letter-spacing:.04em; text-transform:uppercase; }
    .toolbar .ctrl{ display:flex; align-items:center; gap:10px; background: #0b1220; padding:6px 8px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); }
    .toolbar input[type="range"]{ width:120px; }
    .toolbar select, .toolbar button {
      background:#0b1220; color:var(--fg); border:1px solid rgba(255,255,255,0.06); border-radius:8px; padding:6px 8px; font-family:inherit; font-size:13px;
    }
    .toolbar button:hover{ border-color: rgba(255,255,255,0.2); }

    pre#ascii{
      flex:1;
      margin:0;
      padding:10px;
      font-size: 10px;
      line-height: 10px;
      letter-spacing: 0.5px;
      white-space: pre;
      color: var(--fg);
      text-shadow: 0 0 8px rgba(97,218,251,0.2);
      user-select: text;
      transition: filter .3s ease;
      overflow:hidden;
    }
    .status{ font-size:12px; color:var(--muted); padding: 6px 16px; text-align:right; background:rgba(0,0,0,0.2); }
    .brand{ font-weight:700; letter-spacing:.06em; font-size:12px; color:#9cc8ff; }
  </style>
</head>
<body>
  <div class="panel">
    <div class="toolbar">
      <div class="brand">ASCII PLASMA</div>
      <div class="ctrl">
        <label for="charset">Charset</label>
        <select id="charset">
          <option value="@#&$%WX9876543210?!;:+=-,._ ">@#&$%WX9876543210?!;:+=-,._· </option>
          <option value="█▓▒░ .">█▓▒░ .</option>
          <option value="@%#*+=-:. ">@%#*+=-:. ·</option>
          <option value="MWNQ0OZ$7?+=~:, .">MWNQ0OZ$7?+=~:, .</option>
          <option value="⣿⣶⣴⣦⣤⣀ ·">⣿⣶⣴⣦⣤⣀ ·</option>
        </select>
      </div>
      <div class="ctrl">
        <label for="scale">Detail</label>
        <input id="scale" type="range" min="4" max="18" step="1" value="10" />
      </div>
      <div class="ctrl">
        <label for="speed">Speed</label>
        <input id="speed" type="range" min="0" max="2" step="0.01" value="0.8" />
      </div>
      <div class="ctrl">
        <label for="hue">Hue Shift</label>
        <input id="hue" type="range" min="0" max="360" step="1" value="200" />
      </div>
      <div class="ctrl">
        <label for="fx">FX</label>
        <select id="fx">
          <option value="plasma">Plasma</option>
          <option value="waves">Waves</option>
          <option value="swirl">Swirl</option>
          <option value="noise">Noise</option>
        </select>
      </div>
      <button id="toggleGlow" title="Toggle glow">Glow</button>
      <button id="savePng" title="Save snapshot as PNG">Snapshot</button>
    </div>
    <pre id="ascii"></pre>
    <div class="status" id="status"> </div>
  </div>

  <script>
    // (JS remains the same as before)
    // Utility: PRNG with seed for subtle stability
    function mulberry32(a){
      return function(){ var t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296 }
    }

    function valueNoise2D(x, y, rng){
      const x0 = Math.floor(x), y0 = Math.floor(y);
      const xf = x - x0, yf = y - y0;
      function rand(i, j){
        const s = Math.sin(i*127.1 + j*311.7) * 43758.5453;
        return s - Math.floor(s);
      }
      const v00 = rand(x0, y0), v10 = rand(x0+1, y0), v01 = rand(x0, y0+1), v11 = rand(x0+1, y0+1);
      const u = xf*xf*(3-2*xf), v = yf*yf*(3-2*yf);
      const i1 = v00*(1-u)+v10*u; const i2 = v01*(1-u)+v11*u;
      return i1*(1-v)+i2*v;
    }

    const pre = document.getElementById('ascii');
    const statusEl = document.getElementById('status');
    const scaleEl = document.getElementById('scale');
    const speedEl = document.getElementById('speed');
    const charsetEl = document.getElementById('charset');
    const hueEl = document.getElementById('hue');
    const fxEl = document.getElementById('fx');
    const toggleGlowBtn = document.getElementById('toggleGlow');
    const saveBtn = document.getElementById('savePng');

    let widthChars = 140;
    let heightChars = 44;
    let lastFrameTime = performance.now();
    let t = 0;

    function computeDimensions(){
      const cell = parseInt(scaleEl.value, 10);
      const fontSize = cell;
      pre.style.fontSize = fontSize + 'px';
      pre.style.lineHeight = fontSize + 'px';

      widthChars  = Math.max(40, Math.floor(window.innerWidth / (fontSize * 0.60)));
      heightChars = Math.max(20, Math.floor((window.innerHeight-100) / fontSize));
    }

    function mapToChar(v){
      const set = charsetEl.value;
      const i = Math.max(0, Math.min(set.length - 1, Math.floor(v * set.length)));
      return set[i];
    }

    function hueColor(v){
      const h = (hueEl.valueAsNumber + v*180) % 360;
      return `hsl(${h} 90% ${40 + v*40}%)`;
    }

    function renderFrame(dt){
      t += dt * (speedEl.valueAsNumber || 0.8);
      const fx = fxEl.value;

      let output = '';
      const lines = new Array(heightChars);

      for(let y=0; y<heightChars; y++){
        let line = '';
        for(let x=0; x<widthChars; x++){
          const u = x/widthChars, v = y/heightChars;
          let val = 0;
          if(fx === 'plasma'){
            val = 0.5+0.5*(
              Math.sin(10*u + t*0.9) +
              Math.sin(10*v - t*1.1) +
              Math.sin(10*(u+v) + t*0.7)
            )/3;
          } else if(fx === 'waves'){
            val = 0.5 + 0.5*Math.sin(14*Math.hypot(u-0.5, v-0.5) * 3.14159*2 - t);
          } else if(fx === 'swirl'){
            const dx=u-0.5, dy=v-0.5; const r=Math.hypot(dx,dy)+1e-4; const ang=Math.atan2(dy,dx);
            val = 0.5 + 0.5*Math.sin(8*r - 6*ang + t*0.8);
          } else if(fx === 'noise'){
            val = 0;
            val += valueNoise2D(u*8 + t*0.2, v*8 - t*0.2);
            val += valueNoise2D(u*16 - t*0.1, v*16 + t*0.1)*0.5;
            val += valueNoise2D(u*32 + t*0.05, v*32 - t*0.05)*0.25;
            val /= (1 + 0.5 + 0.25);
          }
          line += mapToChar(val);
        }
        lines[y] = line;
      }

      pre.textContent = lines.join("\n");
      pre.style.color = hueColor(0.5);
    }

    function animate(now){
      const dt = Math.min(0.06, (now - lastFrameTime)/1000);
      lastFrameTime = now;
      renderFrame(dt);
      requestAnimationFrame(animate);
    }

    function updateStatus(){
      statusEl.textContent = `${widthChars}×${heightChars} chars  •  ${charsetEl.value.length} glyphs`;
    }

    function onResize(){
      computeDimensions();
      updateStatus();
    }

    window.addEventListener('resize', onResize);
    scaleEl.addEventListener('input', onResize);
    charsetEl.addEventListener('change', updateStatus);

    toggleGlowBtn.addEventListener('click', () => {
      const current = pre.style.filter || 'none';
      pre.style.filter = current.includes('drop-shadow') ? 'none' : 'drop-shadow(0 0 10px rgba(97,218,251,.35)) drop-shadow(0 0 25px rgba(97,218,251,.2))';
    });

    saveBtn.addEventListener('click', () => {
      const canvas = document.createElement('canvas');
      const fontSize = parseInt(getComputedStyle(pre).fontSize, 10);
      canvas.width = Math.ceil(widthChars * fontSize * 0.62);
      canvas.height = Math.ceil(heightChars * fontSize * 1.05);
      const ctx = canvas.getContext('2d');
      ctx.fillStyle = getComputedStyle(document.body).backgroundColor || '#000';
      ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle = '#eaf6ff';
      ctx.font = `${fontSize}px ${getComputedStyle(pre).fontFamily}`;
      ctx.textBaseline = 'top';
      const lines = pre.textContent.split('\n');
      for(let y=0; y<lines.length; y++){
        ctx.fillText(lines[y], 6, 6 + y*fontSize);
      }
      const link = document.createElement('a');
      link.download = `ascii_snapshot_${Date.now()}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    computeDimensions();
    updateStatus();
    requestAnimationFrame(animate);
  </script>
</body>
</html>
